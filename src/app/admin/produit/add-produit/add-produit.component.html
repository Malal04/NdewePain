<div class="form-container">
  <h2> Ajouter un Produit </h2>

  <!-- Message succès / erreur -->
  <p class="message" *ngIf="message">{{ message }}</p>

    <form [formGroup]="produitForm" (ngSubmit)="onSubmit()" enctype="multipart/form-data">
    
        <!-- Catégorie -->
        <div class="form-field">
            <label for="categorie_id">Catégorie <span class="required">*</span></label>
            <select id="categorie_id" formControlName="categorie_id">
                <option value="">-- Sélectionner une catégorie --</option>
                <option *ngFor="let cat of categories" [value]="cat.id">
                {{ cat.nom }}
                </option>
            </select>
            <div class="error" *ngIf="produitForm.get('categorie_id')?.invalid && produitForm.get('categorie_id')?.touched">
                La catégorie est obligatoire.
            </div>
        </div>

        <!-- Nom -->
        <div class="form-field">
            <label for="nom">Nom <span class="required">*</span></label>
            <input id="nom" type="text" formControlName="nom" placeholder="Nom du produit">
            <div class="error" *ngIf="produitForm.get('nom')?.invalid && produitForm.get('nom')?.touched">
                Le nom est obligatoire (max 255 caractères).
            </div>
        </div>

        <!-- Description -->
        <div class="form-field">
            <label for="description">Description</label>
            <textarea id="description" rows="3" formControlName="description" placeholder="Ajoutez une description...">
                
            </textarea>
        </div>

        <!-- Prix unitaire -->
        <div class="form-field">
            <label for="prix_unitaire">Prix unitaire <span class="required">*</span></label>
            <input id="prix_unitaire" type="number" step="0.01" formControlName="prix_unitaire" placeholder="Ex. 1500">
            <div class="error" *ngIf="produitForm.get('prix_unitaire')?.invalid && produitForm.get('prix_unitaire')?.touched">
                Prix obligatoire et positif.
            </div>
        </div>

        <!-- Stock
        <div class="form-field">
            <label for="stock">Stock disponible</label>
            <input id="stock" type="number" min="0" formControlName="stock" placeholder="Ex. 20">
        </div>  -->

        <!-- Photo -->
        <div class="form-field">
            <label for="photo_url">Photo du produit</label>
            <input id="photo_url" type="file" (change)="onFileSelected($event)">
        </div>

        <!-- Allergènes -->
        <div class="form-field">
            <label for="allergenes">Allergènes</label>
            <input id="allergenes" type="text" placeholder="Ex. gluten, lait" (keydown.enter)="addAllergene($any($event))">
            <div class="tags">
                <span class="tag" *ngFor="let allergene of allergenes; let i = index">
                {{ allergene }}
                <button type="button" (click)="removeAllergene(i)">
                    ×
                </button>
                </span>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button type="submit" [disabled]="produitForm.invalid" class="btn-primary"> Enregistrer</button>
            <button type="button" (click)="onCancel()" class="btn-secondary"> Annuler</button>
        </div>

    </form>
</div>
